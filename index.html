<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Sendgrid Template Transfer by astrocaribe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Sendgrid Template Transfer</h1>
      <h2 class="project-tagline">Ruby script to transfer Sendgrid templates from one account to another, using the Sendgrid Template API.</h2>
      <a href="https://github.com/astrocaribe/template_transfer" class="btn">View on GitHub</a>
      <a href="https://github.com/astrocaribe/template_transfer/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/astrocaribe/template_transfer/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="sendgrid-template-transfer-ruby-script" class="anchor" href="#sendgrid-template-transfer-ruby-script" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sendgrid Template Transfer Ruby Script</h1>

<hr>

<p>Currently, there is not an easy option for transferring templates within Sendgrid from one account to another; say, from a development account to a production. While trying to execute this for my current job, I could not find a solution that was already created for this very purpose.</p>

<p>However, Sendgrid does provide a <a href="https://sendgrid.com/docs/API_Reference/Web_API_v3/Template_Engine/templates.html">Template API</a> for this very purpose. This particular solution is for Ruby, but I'm sure other languages can be supported as well. I plan to create a Python solution script for this as well in my free time, so look out for this in the future!</p>

<p>I wrote this to save others the pain of doing this from scratch; I do hope that you find this useful! Below I outline the transfer flow, with included sidenotes of discoveries I made along the way. Enjoy!</p>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Please refer to the <a href="https://github.com/astrocaribe/template_transfer">script</a> repo on specifics for configuration.</p>

<h2>
<a id="script-flow" class="anchor" href="#script-flow" aria-hidden="true"><span class="octicon octicon-link"></span></a>Script Flow</h2>

<p>This script was born out of the lack of resources on how to transfer templates between accounts, using the supplied Sendgrid <a href="https://sendgrid.com/docs/API_Reference/Web_API_v3/Template_Engine/templates.html">Template API</a> and corresponding <a href="https://sendgrid.com/docs/API_Reference/Web_API_v3/Template_Engine/versions.html">Template Versions</a> documentation for transferring multiple versions of a template.</p>

<p><strong>Note:</strong> <em>This solution was coded in Ruby 2.1.2; to code in another language, use this flow as a guide, and code against appropriate analogs.</em></p>

<p><strong>Important Caveat:</strong> <em>Currently, this script *</em>does not** selectively copy templates. This script will copy <strong>ALL</strong> of the templates from the first account.*</p>

<p>With that out of the way, here's the current flow, all examples within are drawn from the <a href="https://sendgrid.com/docs/API_Reference/Web_API_v3/Template_Engine/templates.html">Template API</a> docs:</p>

<h3>
<a id="step-1-retrieve-all-available-templates-from-account1" class="anchor" href="#step-1-retrieve-all-available-templates-from-account1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 1. Retrieve all available templates from Account1</h3>

<p>In this step, all templates are copied from the first account (the <em>transfer from</em> account). This operation <em>does not</em> copy the template content; only the identifying information is retrieved:</p>

<pre><code>{
  "templates": [
    {
      "id": "e8ac01d5-a07a-4a71-b14c-4721136fe6aa",
      "name": "example template name",
      "versions": [
        {
          "id": "5997fcf6-2b9f-484d-acd5-7e9a99f0dc1f",
          "template_id": "9c59c1fb-931a-40fc-a658-50f871f3e41c",
          "active": 1,
          "name": "example version name",
          "updated_at": "2014-03-19 18:56:33"
        }]
     }]
}
</code></pre>

<p>Template versions are also retrieved, but still no template content.</p>

<p>As such, the approach here is to retrieve all the templates, and store the main :id and :name of each in an array in memory. A sample Curl example to the API looks like this:</p>

<pre><code>curl -X GET https://username:password@api.sendgrid.com/v3/templates/
</code></pre>

<h3>
<a id="step-2-recursively-retrieve-each-template-from-account1" class="anchor" href="#step-2-recursively-retrieve-each-template-from-account1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2. Recursively retrieve each template from Account1</h3>

<p>Using the stored array in memory, each template is then retrieved using :id;</p>

<pre><code>curl -X GET https://username:password@api.sendgrid.com/v3/templates/:template_id
</code></pre>

<p>This operation now retrieves the information of interest needed to transfer the templates intact to the receiving account:</p>

<pre><code>{
  "templates": [
    {
      "id": "e8ac01d5-a07a-4a71-b14c-4721136fe6aa",
      "name": "example template name",
      "versions": [
        {
          "id": "de37d11b-082a-42c0-9884-c0c143015a47",
          "user_id": 1234,
          "template_id": "d51480ba-ca3f-465c-bc3e-ceb71d73c38d",
          "active": 1,
          "name": "example version",
          "html_content": "&lt;%body%&gt;&lt;strong&gt;Click to Reset&lt;/strong&gt;",
          "plain_content": "Click to Reset&lt;%body%&gt;",
          "subject": "&lt;%subject%&gt;",
          "updated_at": "2014-05-22 20:05:21"
        }]
      }]
}
</code></pre>

<p>Of interest are the following key pairs for transferring templates intact; :name, :subject, :html_content, :plain_content, and :active. Refer to <a href="https://sendgrid.com/docs/API_Reference/Web_API_v3/Template_Engine/versions.html">Template Versions</a> POST action for more information.</p>

<h3>
<a id="step-3-backup-templates-to-an-external-file" class="anchor" href="#step-3-backup-templates-to-an-external-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3. Backup templates to an external file</h3>

<p>The templates (and their versions) will be stored in a JSON file, with the named format as:</p>

<pre><code>':template_id'.json
</code></pre>

<p>This is an additional step meant to safeguard against a complete loss of templates should something happen after transferring templates, e.g., deleting the first account.</p>

<h3>
<a id="step-4-create-an-empty-template-in-account2" class="anchor" href="#step-4-create-an-empty-template-in-account2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4. Create an empty template in Account2</h3>

<p>Before any templates can be copied to the second account (<em>transfer to</em> account), a new template needs to be created. A name is required to create the new template; the :name key pair saved in Step #1 is used in this step. A prepend string can be configured to distinguish the new template from any existing templates in the second account:</p>

<pre><code>curl -H "Content-Type: application/json" -X POST -d {"name":"Prepend_text"+"template_name"} https://username:password@api.sendgrid.com/v3/templates/
</code></pre>

<p><strong>Notes:</strong><br>
1. Newly created template will have a different :id than that of the existing template.<br>
2. If the template already exists, template creation will fail, and a 400 response is returned. <strong>There is currently no check to skip already created templates, and it is unknown how the process will fail as this scenario has not been tested yet</strong>.<br>
3. Version names <strong>must be unique</strong> accross templates within an account.</p>

<h3>
<a id="step-5-populate-template" class="anchor" href="#step-5-populate-template" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 5. Populate template</h3>

<p>Transfer the template content to the newly created template, using the <a href="https://sendgrid.com/docs/API_Reference/Web_API_v3/Template_Engine/versions.html">Template Versions API</a>.</p>

<pre><code>curl -H "Content-Type: application/json" -X POST -d @template_content.json https://username:password@api.sendgrid.com/v3/templates/:template_id/versions
</code></pre>

<p>The versions of each template is pushed, one at a time, to the new template, using the required key pairs described in Step #2. As a safeguard, all other information is stripped from the version before pushing changes, i.e., information such as :user_id and :updated_at, as these are regenerated on transfer.</p>

<h3>
<a id="step-6-wash-rinse-repeat" class="anchor" href="#step-6-wash-rinse-repeat" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 6. Wash, Rinse, Repeat</h3>

<p>Repeat Steps #2 - #5 for every template in the array retrieved in Step #1. At the end, you should have all templates transferred from your first account to the second!</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/astrocaribe/template_transfer">Sendgrid Template Transfer</a> is maintained by <a href="https://github.com/astrocaribe">astrocaribe</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

